#+TITLE: Kubernetes 笔记
#+AUTHOR: Zhao Wenbin

* Pods

** definition

- Smallest deployable units of computing that can be created and managed in K8S
- A group of Docker containers with shared namespaces and shared volumes


** explain

- a group of containers, relatively tightly coupled
- shared storage/network
- with specification for how to run the containers
- TODO containers share an *IP address and port space*, can communicate with each-other via *localhost*
- volume provides shared filesystem

** notes

- supports more container runtimes (beyond Docker)
- undergroupd is a set of Linux namespaces, cgroups, and potentially other facets of isolation

** TODO life of a pod

- relatively ephemeral
- volume has the same lifetime as the pod
- https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/

** TODO replication

pod 的一个 node 异常后，将重新发起一个新的 pod 替换之

https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/

** Motivation

*** Management

Serve as unit of deployment, horizontal scaling, and replicatoin.

Automatically handles:

- Colocation (co-scheduling)
- shared fate (termination)
- coordinated replication
- resource sharing
- dependency management

** Resource sharing and communication

- can find each other and communicate using *localhost*
- volume for
  + persist data for container restart
  + share among applications

** TODO Usage

** TODO Terminates 


*** TODO How to find each other by *localhost*

* Networking

* Volume

** 不同于 docker volume

docker volume 是将本地的一个目录挂载到 container 中，存在以下问题
1. 实现方式单一（docker driver 提供了一定的扩展功能）
2. 不能在多个容器之间共享
3. 没有生命周期管理（独立于 container）

k8s volume 有以下特点：
1. 与 Pod 生命周期相同
2. 当 Pod 容器重启后，volume 依旧存在
3. Pod 中的窗口共享 volume
4. 有很多种 backend 实现方式

** PersistentVolume & PersistentVolumeClaims

*** PV vs PVC

- PVs are resources in the cluster
- PVCs are requests for those resources and also act as /claim checks/ to the resource.

*** Lifecycle

**** Provisioning

1. Static: Administration allocated
2. Dynamic: automatic provision for PVC request, based on =StorageClasses=

**** Binding

- PVC request amount of storage and access mode
- Master find a matching PV for PVC and binding them together

**** Using


   

* Deployments
* ReplicaSets

- Use =Deployment= instead when possible to support rolling update feature
- =Deployment= is a high-level abstract of =ReplicaSets=
- Similar to =ReplicationController=, but support set-based selector
- Specific pod configuration by =spec.template=

* TODO Service
