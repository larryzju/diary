<!DOCTYPE html>
<html>
	<head>
		<title>timer.org</title>
		<link rel="stylesheet" href="/diary/resources/css/main.css" />
		<link rel="stylesheet" href="/diary/resources/highlight/styles/default.css" />
		<script src="/diary/resources/js/jquery-3.4.1.min.js"></script>
		<script src="/diary/resources/js/swgen.js"></script>
		<script src="/diary/resources/highlight/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body>
		<nav id='content'>
		</nav>
		<section class="main-article-area">
			<div id='main'>
				<h1 id="overview">Overview</h1>
<p>PIT (Programmable Interval Timer) chip</p>
<ol class="incremental">
<li>3 independent frequency dividers</li>
<li>each has an output</li>
</ol>
<p>Basic frequency is 1.193182 MHz. (1/4 of the CPU frequency, 1/3 of the CGA video contorller frequency, 1/12 of the television circuitry frequency).</p>
<p>Only PIT channel 2 gate is controlled by IO port 0x61, bit 0.</p>
<h1 id="output">Output</h1>
<dl class="incremental">
<dt>channel 0</dt>
<dd>connected directly to IRQ0. BIOS set channel 0 with a count of 65536/65535 (18.2065 Hz)
</dd>
<dt>channel 1</dt>
<dd>unusable (once used to refresh DRAM but not used today)
</dd>
<dt>channel 2</dt>
<dd>connected to the PC speaker
</dd>
</dl>
<h1 id="io-ports">I/O Ports</h1>
<h2 id="ports">Ports</h2>
<table>
<thead>
<tr class="header">
<th>I/O port</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0x40</td>
<td>Channel 0 data port (r/w)</td>
</tr>
<tr class="even">
<td>0x41</td>
<td>Channel 1 data port (r/w)</td>
</tr>
<tr class="odd">
<td>0x42</td>
<td>Channel 2 data port (r/w)</td>
</tr>
<tr class="even">
<td>0x43</td>
<td>Mode/Command register (write only)</td>
</tr>
</tbody>
</table>
<h2 id="modecommand-register">Mode/Command Register</h2>
<table>
<thead>
<tr class="header">
<th>Bits</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>6 and 7</td>
<td>channel selector</td>
</tr>
<tr class="even">
<td>4 and 5</td>
<td>access mode: 00: Latch count value comand, 01: lobyte only, 10: hibyte only, 11: lobyte/hibyte</td>
</tr>
<tr class="odd">
<td>1 to 3</td>
<td>operating mode (6 kinds)</td>
</tr>
<tr class="even">
<td>0</td>
<td>BCD/Binary mode</td>
</tr>
</tbody>
</table>
<h2 id="operating-mode"><span class="todo TODO">TODO</span> Operating Mode</h2>
<h1 id="code-analysis">Code Analysis</h1>
<h2 id="basic-steps">Basic Steps</h2>
<ol class="incremental">
<li>add timer handler to IRQ1 (IDT 32)</li>
<li>Command 0x36:
<ul class="incremental">
<li>select channel 0</li>
<li>access mode: lobyte/hibyte</li>
<li>operating mode: 2 (rate generator)</li>
<li>binary mode</li>
</ul></li>
<li>write frequency divisor (lobyte first)</li>
<li>increse <code>timer_ticker</code> by one per tick, and increase <code>ticker</code> by one every 18 <code>timer_ticks</code></li>
</ol>

			</div>
		</section>
	</body>
</html>
