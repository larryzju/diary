<!DOCTYPE html>
<html>
	<head>
		<title>vga.md</title>
		<link rel="stylesheet" href="/diary/resources/css/main.css" />
		<link rel="stylesheet" href="/diary/resources/highlight/styles/default.css" />
		<script src="/diary/resources/js/jquery-3.4.1.min.js"></script>
		<script src="/diary/resources/js/swgen.js"></script>
		<script src="/diary/resources/highlight/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body>
		<nav id='content'>
		</nav>
		<section class="main-article-area">
			<div id='main'>
				<h1 id="section">笔记</h1>

<p>VGA chip currently a <strong>legacy</strong> device, it is a good place to begin practicing your video driver skills.</p>

<h1 id="vga-">VGA 构成</h1>

<p><img src="http://wiki.osdev.org/images/thumb/7/76/VGA_overview.gif/325px-VGA_overview.gif" alt="VGA构成示意" /></p>

<h1 id="section-1">寄存器</h1>

<p>有超过 300 个内部寄存器（8位），通过索引（indexed）方式来节省 I/O 地址空间</p>

<h2 id="port-0x3c0">Port 0x3C0</h2>

<p>both the index and data bytes to the same port.</p>

<p>顺序写入时 VGA 循环切换意义，初始化时并不知道是何种状态，取读 0x3DA 后初始化为 index 状态。</p>

<p>To read the contents, feed the index into port 0x3C0, then read the value from 0x3C1</p>

<h2 id="port-0x3c2">Port 0x3C2</h2>

<p>输出寄存器。使用 0x3C2 来写，0x3CC 来读</p>

<p>第 0 位控制其它寄存器的位置：</p>

<ul>
  <li>cleared: port 0x3D4 is mapped to 0x3B4, port 0x3DA is mapped to 0x3BA</li>
</ul>

<h2 id="port-0x3c4-0x3ce-0x3d4">Port 0x3C4, 0x3CE, 0x3D4</h2>

<p>索引寄存器，相应的 port + 1 为数据寄存器（用于读写）</p>

<p>有些程序封装的同时读 写 16-bit 内容</p>

<h2 id="port-0x3c6">Port 0x3C6</h2>

<p>包含 DAC Mask Register, 可以直接进行读写。一般情况设为 0xff</p>

<h2 id="port-0x3c8">Port 0x3C8</h2>

<p>0x3C8, 0x3C9, 0x3C7 控制 DAC。</p>

<p>DAC 中的寄存器包含 18 位，6 位用表示一种颜色。</p>

<p>要写入一个颜色，把 color index 写入 0x3C8，再写入 3 字节到 0x3C9（RGB）。如果要写入多个 DAC，可以在 0x3C9 中连续写入。</p>

<p>要读取 DAC 节目，先把 index 写入到 0x3C7，然后可以顺序从 0x3C9 中读取</p>

<h1 id="video-memory-layout">Video Memory Layout</h1>

<p>包含四个 planes 内存块（64KB），总共提供了 256k 的显示内存。</p>

<p>与 Sequencer 相连，该组件负责将内存解释为相应的颜色。The way colors are organized in this memory mainly depends on the color depth.</p>

<p>Specific details about how memory is accessed from the host is can be found by reading about the Graphics Controller(?), detailed information about video memory is rendered can be found by reading about the Sequencer.</p>

<h1 id="color-graphics-mode">16-color graphics mode</h1>

<p>半字节表示一个颜色（16种）。 VGA 对每个像素在 4 个 plane 中各保存一位空间</p>

<p>Bit 7 of each address contains information about the first pixel, Bit 6 has information about the next pixel, and so on.</p>

<p>Plane 0 contains the first bits of all pixels, Plane 1 the second bits and so on.
<em>Plane Write Enable Register</em> 用于选定要写入的 plane</p>

<h1 id="color-graphics-mode-1">256-color graphics mode</h1>

<p>each byte of video memory describe exactly one pixel. Pixels are generated by increasing address in linear mode, with all colors taken from plane 0.</p>

<p>planar mode (Mode X)中，连续四个像素信息依次被分配给 4 个 plane</p>

<p>linear mode 中，每个字节都被映射成屏幕上的一个像素。</p>

<h1 id="text-mode">text mode</h1>

<p>Plane0 包含字符，Plane1 包含相应属性，Plane2 包含字体。</p>

<h1 id="section-2">不明白的地方</h1>

<h2 id="pci">PCI</h2>

<blockquote>
  <p>PCI boards do <em>not</em> report the VGA addresses in their configuration space, and that the address can not be remapped. It is therefore not possible to properly operate two cards in VGA mode at the same time.</p>
</blockquote>

<h1 id="section-3">参考资料</h1>

<ul>
  <li><a href="http://wiki.osdev.org/VGA_Hardware">VGA Hardware</a></li>
</ul>

<p>未完待续</p>

			</div>
		</section>
	</body>
</html>
