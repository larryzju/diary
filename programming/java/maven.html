<!DOCTYPE html>
<html>
	<head>
		<title>maven.org</title>
		<link rel="stylesheet" href="/diary/resources/css/main.css" />
		<link rel="stylesheet" href="/diary/resources/highlight/styles/default.css" />
		<script src="/diary/resources/js/jquery-3.4.1.min.js"></script>
		<script src="/diary/resources/js/swgen.js"></script>
		<script src="/diary/resources/highlight/highlight.pack.js"></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body>
		<nav id='content'>
		</nav>
		<section class="main-article-area">
			<div id='main'>
				<h1 id="pom">pom</h1>
<p>maven 的核心为 pom, 通过 pom.xml 配置，定义了 project，包括配置和源码。</p>
<p>配置包括与开发者相关的，缺陷跟踪系统，组织和许可，项目 URL，项目信赖以及其他。</p>
<p>pom.xml 中的核心元素包括</p>
<dl class="incremental">
<dt>project</dt>
<dd>声明一些命名空间及 xsd（让第三方工具快速编辑 pom）
</dd>
<dt>modelVersion</dt>
<dd><code>4.0.0</code> （对于 maven2 和 maven3）
</dd>
<dt>groupId</dt>
<dd>
</dd>
<dt>artifactId</dt>
<dd>
</dd>
<dt>version</dt>
<dd>
</dd>
<dt>name</dt>
<dd>建议每个 pom 声明 name，指定项目名称
</dd>
<dt>dependencies/dependicy</dt>
<dd>坐标依赖
</dd>
<dt>scope</dt>
<dd>依赖范围
</dd>
</dl>
<h1 id="dependency-插件">dependency 插件</h1>
<p>从外网攒 jar 包，用 <code>dependency:get</code> 插件，具体用法如：</p>
<pre class="shell"><code>mvn dependency:get -DartifactId=spark-sql_2.11 -DgroupId=org.apache.spark -Dversion=2.1.1 -Dclassifier=sources
</code></pre>
<p>其中 classifier 为可选的，用于下载 javadoc 或 sources</p>
<h1 id="repositories-配置">repositories 配置</h1>
<h2 id="在工程-pom.xml-配置"><span class="todo TODO">TODO</span> 在工程 pom.xml 配置</h2>
<p>待补充</p>
<h2 id="在-settings.xml-配置">在 settings.xml 配置</h2>
<p>在 <code>~/.m2/settings.xml</code> 中 profiles 一节中添加配置，如下</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">&lt;profile&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="kw">&lt;id&gt;</span>cloudera<span class="kw">&lt;/id&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="kw">&lt;repositories&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="kw">&lt;repository&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="kw">&lt;id&gt;</span>cloudera<span class="kw">&lt;/id&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="kw">&lt;name&gt;</span>cloudera repo<span class="kw">&lt;/name&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="kw">&lt;url&gt;</span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="kw">&lt;/url&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="kw">&lt;/repository&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="kw">&lt;/repositories&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="kw">&lt;/profile&gt;</span></span></code></pre></div>
<p>使用时，需要为 maven 指定 profile，如 <code>mvn -Pcloudera</code></p>
<h1 id="mirror-配置">mirror 配置</h1>
<p>国内中央镜像源可以使用阿里镜像，在 <code>~/.m2/settings.xml</code> 中添加</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">&lt;mirrors&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="kw">&lt;mirror&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="kw">&lt;id&gt;</span>aliyun<span class="kw">&lt;/id&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="kw">&lt;mirrorOf&gt;</span>central<span class="kw">&lt;/mirrorOf&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="kw">&lt;name&gt;</span>Human Readable Name for this Mirror.<span class="kw">&lt;/name&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="kw">&lt;url&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="kw">&lt;/url&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="kw">&lt;/mirror&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="kw">&lt;/mirrors&gt;</span></span></code></pre></div>
<h1 id="build-classpath">build classpath</h1>
<p><code>maven dependency:build-classpath</code> 可以从当前工程（pom.xml）中生成 classpath</p>
<p>比如 spark hive 需要指定 classpath，可以</p>
<ol class="incremental">
<li>从 <code>hive-exec</code> jar 包中提取 pom.xml</li>
<li>使用 <code>maven dependency:build-classpath</code> 命令生成 classpath</li>
<li>classpath 中补充 hive-exec 所在的本地 jar 包路径</li>
</ol>
<h1 id="archetype-generate">archetype generate</h1>
<h2 id="说明">说明</h2>
<p>使用 maven-archetype-plugin 建立一个新的工程</p>
<pre class="example"><code>mvn archetype:generate
</code></pre>
<p>默认情况会从两个位置下载 XML 文件：</p>
<ol class="incremental">
<li>remote: <a href="https://repo.maven.apache.org/maven2/archetype-catalog.xml">https://repo.maven.apache.org/maven2/archetype-catalog.xml</a></li>
<li>local: 当前目录下的 archetype-catalog.xml</li>
</ol>
<p>然后进入一个交互式选择模式，通过指定模板编号，填写相应的 GAV 名称，生成一个空的项目</p>
<h2 id="示例">示例</h2>
<p>如果需要新建一个 scala 工程，需要以下步骤</p>
<ol class="incremental">
<li><code>mvn archetype:generate</code> 进入交互式命令行（可能需要一段时间）</li>
<li>输入 <code>scala</code> 来筛选 scala 相关的模板</li>
<li>选择具体的编号，这里选择 <code>7: remote -&gt; net.alchim31.maven:scala-archetype-simple</code></li>
<li>填写 GAV 信息，按 "Y" 生成工程</li>
</ol>
<h2 id="问题">问题</h2>
<p>aliyun 的 mirrors 会导致 remote 下载异常？</p>
<h2 id="速度">速度</h2>
<p>xml 文件有 5M 大小，网络比较慢的情况下，下载时间过长。</p>
<p>可以先用 wget 下载文件到 <code>~/.m2/repository</code> 目录下，使用 <code>mvn  archetype:generate -DarchetypeCatalog=local</code> 加载之</p>
<p>另外，可以为 <code>maven -X</code> 参数打开 debug 来调试</p>

			</div>
		</section>
	</body>
</html>
