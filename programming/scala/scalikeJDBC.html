<!DOCTYPE html>
<html>
	<head>
		<title>scalikeJDBC.org</title>
		<link rel="stylesheet" href="/diary/_resources/css/main.css" />
		<script src="/diary/_resources/js/jquery-3.4.1.min.js"></script>
		<script src="/diary/_resources/js/swgen.js"></script>
	</head>
	<body>
		<nav id='content'>
		</nav>
		<section class="main-article-area">
			<div id='main'>
				<h1 id="question">question</h1>
<ul class="incremental">
<li>[ ] Commons DBCP</li>
<li>[ ] c3p0 though ConnectionPool implementation</li>
<li>[ ] <code>ConnectionPool.singleton</code></li>
<li>[ ] <code>implicit val session = AutoSession</code></li>
</ul>
<h1 id="dependencies">dependencies</h1>
<ul class="incremental">
<li>scalikeJDBC</li>
<li>jdbc driver</li>
<li>slf4j implementation</li>
</ul>
<h1 id="example">example</h1>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">import</span> scalikejdbc._

<span class="co">// initialize JDBC driver &amp; connection pool</span>
Class.<span class="fu">forName</span>(<span class="st">&quot;org.h2.Driver&quot;</span>)
ConnectionPool.<span class="fu">singleton</span>(<span class="st">&quot;jdbc:h2:mem:hello&quot;</span>, <span class="st">&quot;user&quot;</span>, <span class="st">&quot;pass&quot;</span>)

<span class="co">// ad-hoc session provider on the REPL</span>
<span class="kw">implicit</span> <span class="kw">val</span> session = AutoSession

<span class="co">// table creation, you can run DDL by using #execute as same as JDBC</span>
sql<span class="st">&quot;&quot;&quot;</span>
create table <span class="fu">members</span> (
  id serial not <span class="kw">null</span> primary key,
  name <span class="fu">varchar</span>(<span class="dv">64</span>),
  created_at timestamp not <span class="kw">null</span>
)
<span class="st">&quot;&quot;&quot;.execute.apply()</span>

<span class="co">// insert initial data</span>
Seq(<span class="st">&quot;Alice&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Chris&quot;</span>) foreach { name =&gt;
  sql<span class="st">&quot;insert into members (name, created_at) values (${name}, current_timestamp)&quot;</span>.<span class="fu">update</span>.<span class="fu">apply</span>()
}

<span class="co">// for now, retrieves all data as Map value</span>
<span class="kw">val</span> entities: List[Map[String, Any]] = sql<span class="st">&quot;select * from members&quot;</span>.<span class="fu">map</span>(_.<span class="fu">toMap</span>).<span class="fu">list</span>.<span class="fu">apply</span>()

<span class="co">// defines entity object and extractor</span>
<span class="kw">import</span> java.<span class="fu">time</span>._
<span class="kw">case</span> <span class="kw">class</span> Member(id: Long, name: Option[String], createdAt: ZonedDateTime)
<span class="kw">object</span> Member <span class="kw">extends</span> SQLSyntaxSupport[Member] {
  <span class="kw">override</span> <span class="kw">val</span> tableName = <span class="st">&quot;members&quot;</span>
  <span class="kw">def</span> <span class="fu">apply</span>(rs: WrappedResultSet) = <span class="kw">new</span> Member(
    rs.<span class="fu">long</span>(<span class="st">&quot;id&quot;</span>), rs.<span class="fu">stringOpt</span>(<span class="st">&quot;name&quot;</span>), rs.<span class="fu">zonedDateTime</span>(<span class="st">&quot;created_at&quot;</span>))
}

<span class="co">// find all members</span>
<span class="kw">val</span> members: List[Member] = sql<span class="st">&quot;select * from members&quot;</span>.<span class="fu">map</span>(rs =&gt; Member(rs)).<span class="fu">list</span>.<span class="fu">apply</span>()

<span class="co">// use paste mode (:paste) on the Scala REPL</span>
<span class="kw">val</span> m = Member.<span class="fu">syntax</span>(<span class="st">&quot;m&quot;</span>)
<span class="kw">val</span> name = <span class="st">&quot;Alice&quot;</span>
<span class="kw">val</span> alice: Option[Member] = withSQL {
  select.<span class="fu">from</span>(Member as m).<span class="fu">where</span>.<span class="fu">eq</span>(m.<span class="fu">name</span>, name)
}.<span class="fu">map</span>(rs =&gt; Member(rs)).<span class="fu">single</span>.<span class="fu">apply</span>()</code></pre></div>
<h1 id="流程">流程</h1>
<ol class="incremental">
<li>init jdbc driver</li>
<li>init connection pool</li>
<li>implicit session ( AutoSession )</li>
</ol>
<h1 id="api">API</h1>
<ul class="incremental">
<li><code>SQL.{execute,update,list,map,single}.apply</code></li>
<li><code>extends SQLSyntaxSupport[T]</code></li>
<li>Type-safe SDL，&lt;case class&gt; as name，类似于 spark sql api</li>
</ul>
<h1 id="特点">特点</h1>
<ul class="incremental">
<li>SDL</li>
<li>纯 scala 语法</li>
<li>transcation control
<ul class="incremental">
<li>DB autoCommit { implicit session =&gt; ...}</li>
<li>DB localTx { implicit session =&gt; ...}</li>
<li>DB withinTx { implicit session =&gt; ...}</li>
<li>DB readOnly { implicit session =&gt; ...}</li>
</ul></li>
<li>Useful Query Inspections：显示 executed sql debug 信息</li>
<li>testing support</li>
</ul>

			</div>
		</section>
	</body>
</html>
