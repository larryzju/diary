<!DOCTYPE html>
<html>
	<head>
		<title>how-to-write-go-code.org</title>
		<link rel="stylesheet" href="/diary/resources/css/main.css" />
		<link rel="stylesheet" href="/diary/resources/highlight/styles/default.css" />
		<script src="/diary/resources/js/jquery-3.4.1.min.js"></script>
		<script src="/diary/resources/js/swgen.js"></script>
		<script src="/diary/resources/highlight/highlight.pack.js"></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body>
		<nav id='content'>
		</nav>
		<section class="main-article-area">
			<div id='main'>
				<h1 id="代码组织">代码组织</h1>
<h2 id="目录结构">目录结构</h2>
<ul class="incremental">
<li>workspace
<ul class="incremental">
<li>repositories(版本库)
<ul class="incremental">
<li>packages（包）
<ul class="incremental">
<li>go source files</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<h2 id="关系">关系</h2>
<ul class="incremental">
<li>包目录决定了导入路径 ( import path )</li>
</ul>
<h2 id="workspace">Workspace</h2>
<h3 id="目录">目录</h3>
<p>包含三级目录</p>
<ol class="incremental">
<li><strong>src</strong> contains Go source files</li>
<li><strong>pkg</strong> contains package objects</li>
<li><strong>bin</strong> contains executable commands</li>
</ol>
<h3 id="关系-1">关系</h3>
<ul class="incremental">
<li>go tool 从 src 中编译包，生成二进制到 pkg 和 bin</li>
<li>src 目录下有多个子 package，每个 package 可以有独立的版本管理（repositories）</li>
</ul>
<h1 id="gopath">GOPATH</h1>
<ul class="incremental">
<li>用于设定 workspace 的位置</li>
<li>默认为 <code>${HOME}/go</code></li>
<li><strong>不能</strong> 与 GO 安装位置重复</li>
<li>通过 <code>go env GOPATH</code> 查看当前 GOPATH 设置</li>
<li>为了方便运行，可以加入 PATH： <code>export PATH=$PATH:$(go env GOPATH)/bin</code></li>
<li>通过 <code>go help gopath</code> 查看帮助</li>
</ul>
<h2 id="goroot"><span class="todo TODO">TODO</span> GOROOT</h2>
<h1 id="import-paths">Import Paths</h1>
<ul class="incremental">
<li>字符串，标识一个包</li>
<li>导入路径与包在 workspace 中的目录一致</li>
<li>可以是一个远程仓库</li>
<li>注意起名的惯例，如 <code>github.com/larryzju/xxx</code> ，以免重复</li>
</ul>
<h1 id="编译和运行">编译和运行</h1>
<h2 id="步骤">步骤</h2>
<ol class="incremental">
<li>设定 GOPATH</li>
<li>创建 package 目录</li>
<li>编程</li>
<li>使用 <code>go install &lt;github.com/larry/package-name&gt;</code> 生成(可以在任意路径)</li>
<li>生成结果位于 <code>$WORKSPACE/{bin,pkg}</code> （视是否可执行而定）</li>
<li>[OPTIONAL] 版本管理 package（在包的最终目录下，不需要整个路径）</li>
</ol>
<h2 id="注意">注意</h2>
<ul class="incremental">
<li>设定 GOPATH， <code>go install &lt;package-path&gt;</code> 可以在任意路径下进行</li>
<li>如果已经在当前包的最终目录下，可以直接 <code>go install</code></li>
<li>可以使用 <code>go build</code> 编译; <code>go install</code> 包含 build，同时生成文件</li>
<li>go 生成的可执行文件是静态链接，可独立运行</li>
</ul>
<h2 id="问题">问题</h2>
<h3 id="如何实现跨平台编译"><span class="todo TODO">TODO</span> 如何实现跨平台编译</h3>
<h1 id="package-names">Package names</h1>
<ul class="incremental">
<li>package name 是导入后被调用时写的名称</li>
<li>all files in a package must use the same name.</li>
<li>惯例是以导入路径的最后一个元素作为包名</li>
<li>可执行命令包名必须为 <code>main</code></li>
<li>生成的二进制文件中不需要担心包名重复（Why？），但需要保护导入路径唯一</li>
</ul>
<h1 id="testing">Testing</h1>
<ul class="incremental">
<li><code>go test</code> 命令和 <code>testing</code> 包</li>
<li>文件命名以 <code>_test.go</code> 为后缀，并以 <code>func TestXXX( t *testing.T )</code> 来写测试函数</li>
<li>使用 <code>go help test</code> 来查看帮助</li>
</ul>
<h1 id="remote-packages">Remote Packages</h1>
<ul class="incremental">
<li>使用 <code>go get</code> 来获取远程包</li>
<li>默认获取到 <code>GOPATH</code> 路径下</li>
<li>使用 <code>go help importpath</code> 来查看帮助</li>
</ul>

			</div>
		</section>
	</body>
</html>
