<!DOCTYPE html>
<html>
	<head>
		<title>mail.org</title>
		<link rel="stylesheet" href="/diary/_resources/css/main.css" />
		<script src="/diary/_resources/js/jquery-3.4.1.min.js"></script>
		<script src="/diary/_resources/js/swgen.js"></script>
	</head>
	<body>
		<nav id='content'>
		</nav>
		<section class="main-article-area">
			<div id='main'>
				<h1 id="历史">历史</h1>
<ol class="incremental">
<li>1960 年代出现</li>
<li>1971 年通过网络发送第一份电子邮件</li>
<li>1987 年中国第一封电子邮件</li>
</ol>
<h1 id="vs-即时通讯">vs 即时通讯</h1>
<ul class="incremental">
<li>存档特性，可作为证据</li>
<li>商业环境内使用，可控</li>
<li>与其它环境的集成</li>
<li>干扰小</li>
</ul>
<h1 id="架构">架构</h1>
<h2 id="原理图">原理图</h2>
<p><img src="archicture.png" /></p>
<h2 id="概述">概述</h2>
<p>相对复杂，由很多部分组成，之间相互协作。外围有一些扩展，如安全性扩展。</p>
<p>核心分为四个组件：</p>
<ol class="incremental">
<li>MUA：客户端</li>
<li>MTA：发送代理</li>
<li>MDA：寄送代理</li>
<li>MRA：接收代理</li>
</ol>
<p>协议分为收发两种：</p>
<dl class="incremental">
<dt>发送</dt>
<dd>SMTP
</dd>
<dt>接收</dt>
<dd>IMAP/POP3
</dd>
</dl>
<p>另外涉及 DNS 相关知识（需要将邮件服务域名转换为主机名）</p>
<h2 id="mua">MUA</h2>
<p>邮件客户端（user agent），主要用于收发邮件。</p>
<p>常见的客户端如 web 页面，mac mail, outlook, thunderbird, foxmail, mutt 等。</p>
<p>通过 IMAP/POP3 方式接收邮件，按用户进行标识，可选是否在服务器保存。其中：</p>
<ul class="incremental">
<li>IMAP 协议允许客户端操作与服务器同步，效果更好</li>
<li>POP3 只限在本地操作，但简单省资源</li>
</ul>
<h2 id="mta">MTA</h2>
<p>邮件传输代理，亦即通常所说的邮件服务器（核心）。</p>
<p>使用 SMTP 协议沟通 MUA 与 MTA，实现邮件的发送。实际上，可以看作 MTA 是对 SMTP 的一种实现。</p>
<p>常见的实现方案如 sendmail 和 postfix，后者配置更简单（人性化）。</p>
<p>MTA 只负责传输，由 MDA 来进行具体的数据存储</p>
<h2 id="mda">MDA</h2>
<p>邮件寄送代理，负责邮件的存储管理。与 MTA 关系密切。</p>
<p>默认邮件被存储于 <code>/var/spool/mail/&lt;username&gt;</code> 目录，MDA 除了存储管理之外，还可以对邮件进行垃圾过滤及病毒扫描处理。</p>
<p>常用的实现有 procmail 和 maildrop，前者使用更多。</p>
<h2 id="mra">MRA</h2>
<p>邮件接收代理，提供了 IMAP 或 POP3 协议服务。常用实现为 dovecot。</p>
<p>考虑到安全性，进行 SSL 加密。加密后的协议称为 IMAPS 和 POP3S</p>
<h2 id="dns">DNS</h2>
<p>邮箱通过 <code>&lt;username&gt;@(&lt;hostname&gt;|&lt;domain-name&gt;)</code> 来标识。</p>
<p>发送和接收时需要查找 DNS 中 mx 记录（域名与主机对应关系）。</p>
<h3 id="工具">工具</h3>
<p>通过 dig 命令查看 mx 信息：</p>
<pre class="shell"><code>dig -t mx qq.com
</code></pre>
<p>一个域名可能对应到多个主机地址</p>
<h1 id="postfix-搭建"><span class="todo TODO">TODO</span> postfix 搭建</h1>
<h1 id="dovecot-搭建"><span class="todo TODO">TODO</span> dovecot 搭建</h1>
<h1 id="procmail-搭建"><span class="todo TODO">TODO</span> procmail 搭建</h1>
<h1 id="dns-服务搭建"><span class="todo TODO">TODO</span> dns 服务搭建</h1>
<h1 id="安全性"><span class="todo TODO">TODO</span> 安全性</h1>
<h1 id="管理页面"><span class="todo TODO">TODO</span> 管理页面</h1>
<h1 id="参考资料">参考资料</h1>
<ul class="incremental">
<li><a href="https://www.youtube.com/watch?v=U0j4Je7FgVE">LinuxCast-邮件服务原理及架构</a></li>
</ul>

			</div>
		</section>
	</body>
</html>
