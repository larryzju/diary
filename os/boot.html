<!DOCTYPE html>
<html>
	<head>
		<title>boot.org</title>
		<link rel="stylesheet" href="/diary/resources/css/main.css" />
		<link rel="stylesheet" href="/diary/resources/highlight/styles/default.css" />
		<script src="/diary/resources/js/jquery-3.4.1.min.js"></script>
		<script src="/diary/resources/js/swgen.js"></script>
		<script src="/diary/resources/highlight/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body>
		<nav id='content'>
		</nav>
		<section class="main-article-area">
			<div id='main'>
				<h1 id="说明">说明</h1>
<p>以下内容参考自 freebsd1.0/sys/i386/i386/README.MARCH</p>
<h1 id="整体流程">整体流程</h1>
<ol class="incremental">
<li>上电后由 BIOS 完成自检</li>
<li>BIOS 加载 sector 1, track 0 到 0000:7c00H 处，进行第一步启动</li>
<li>加载 second stage 到 0000:1000H 进行第二步启动</li>
<li>加载操作系统内核，初始化后交由 kernel 进行启动</li>
<li>操作系统启动</li>
</ol>
<h1 id="bios-加载">BIOS 加载</h1>
<ul class="incremental">
<li>读 sector 1, track 0 扇区到内存 0000:7c00H 处</li>
<li>要求 0000:7DFEH（即 512 的最后两个字节）为 AA55H</li>
<li>兼容 DOS 模式，若 boot device 为硬盘，则需要额外加载 active partition 扇区内容</li>
<li>硬盘的第一扇区包含 MS-DOS boot code 和 record partition table</li>
<li>硬盘模式 BIOS 将自身移动到别的位置，并将硬盘第一扇区加载到 7C00H</li>
</ul>
<h1 id="the-first-stage-bootstrap-loader">The First Stage BootStrap Loader</h1>
<ul class="incremental">
<li>被加载到 0000:7C00H</li>
<li>作用是将自己和 second stage 加载到内存 0000:1000H
<ul class="incremental">
<li>floopy 的第一柱面作为 boot 之用</li>
<li>hard disk active partition 中前 29 个 sector 保存具体的 stage boot</li>
</ul></li>
</ul>
<h1 id="the-second-stage-bootstrap-loader">The Second Stage BootStrap Loader</h1>
<ul class="incremental">
<li>用于加载内核</li>
<li>由于内核比较大，因而在保护模式下进行</li>
<li>因为调用 BIOS，会在保护模式下与实模式间进行切换，所以 cs 和 ds 段不于 64K</li>
<li>将第一 stage 所在 [0000:1000H,0000:1200H) 用作 BIOS IO buffer</li>
<li>第一stage 空间后面跟着 GDT Table 和 second stage boot loader</li>
<li>内核镜像被加载到大于 1M 的位置，并将信息压栈，控制交给内核，信息包括
<ul class="incremental">
<li>type of boot device</li>
<li>size of base memory</li>
<li>size of the extend memory</li>
</ul></li>
</ul>
<h1 id="freebsdunix-startup">FreeBSD/UNIX StartUp</h1>
<ul class="incremental">
<li>内核位于大于 1M 的内存位置，CPU 处于保护模式</li>
<li>link-editor descriptor file( vuifile ) 决定 cs 和 ds 的位置在 1MB 以上的空间</li>
</ul>

			</div>
		</section>
	</body>
</html>
