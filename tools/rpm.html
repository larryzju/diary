<!DOCTYPE html>
<html>
	<head>
		<title>rpm.org</title>
		<link rel="stylesheet" href="/diary/resources/css/main.css" />
		<link rel="stylesheet" href="/diary/resources/highlight/styles/default.css" />
		<script src="/diary/resources/js/jquery-3.4.1.min.js"></script>
		<script src="/diary/resources/js/swgen.js"></script>
		<script src="/diary/resources/highlight/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body>
		<nav id='content'>
		</nav>
		<section class="main-article-area">
			<div id='main'>
				<h1 id="reference">Reference</h1>
<ul class="incremental">
<li><a href="http://fedoranews.org/alex/tutorial/rpm/index.shtml">RPM Tutorial</a></li>
</ul>
<h1 id="useful-command">Useful command</h1>
<h2 id="install">Install</h2>
<ul class="incremental">
<li><code>rpm -i &lt;package&gt;</code> : Install a package</li>
<li><code>-v</code> : verbose</li>
<li><code>-h</code> : show hash marks for a nicer display (can also use <code>--percent</code> to show percentage)</li>
<li><code>-vv</code>: verbose more</li>
<li><code>--test</code>: <em>simulate</em></li>
</ul>
<h2 id="updatedowngrade">Update/Downgrade</h2>
<ul class="incremental">
<li><code>rpm -Uvh &lt;package&gt;</code> : Update a package</li>
<li><code>rpm -Uvh --oldpackage &lt;package&gt;</code> : Downgrade a package</li>
<li>With <code>-U</code> command: if package has not been installed, it will be installed</li>
<li>Use <code>-Fvh</code> parameter: 'F' for freshen. This will upgrade packages, but only ones for which an earlier version is installed.</li>
<li><strong><strong>Never</strong></strong> do multiple packages upgrade: <code>rpm -Fvh /fedora/updates/*.rpm</code> (For sake of multiple version or arch packages)</li>
</ul>
<h2 id="erase">Erase</h2>
<ul class="incremental">
<li><code>rpm -e &lt;package&gt;</code> : erase a package, will fail when other packages dependend on it</li>
<li><code>rpm -q --whatrequires &lt;package&gt;</code>: check packages that require this RPM package</li>
<li><strong><strong>Forget</strong></strong> the danger parameters =&quot;--nodeps&quot;= and =&quot;--force&quot;=</li>
</ul>
<h2 id="query">Query</h2>
<ul class="incremental">
<li><code>rpm -q &lt;package&gt;</code>: to see whether the package had been installed and print its full name</li>
<li><code>rpm -qa | grep -i python</code>: check all package installed</li>
<li><code>rpm -qip &lt;package-file&gt;</code>: show rpm package file's info (metadata)</li>
<li><code>rpm -qR &lt;package&gt;</code>: to check the requirements of current package</li>
<li><code>rpm -qf &lt;local file&gt;</code>: which package provide this file</li>
<li><code>rpm -ql &lt;package&gt;</code>: verify the contents of a package</li>
<li><code>rpm -q --qf &quot;Kernel arch type is: %{ARCH}\nKernel name is: %{VERSION}\n&quot; kernel</code>: &quot;Queryformat&quot; for showing current installed kernel packages info</li>
</ul>
<h1 id="feature">Feature</h1>
<h2 id="install-package-or-update-package-or-get-package-info-from-internet">install package (or update package, or get package info) from Internet</h2>
<ul class="incremental">
<li>Use URL as package name</li>
<li>set proxy with <code>--httpproxy</code> or <code>--ftpproxy</code></li>
</ul>
<h2 id="simulate-installation">Simulate installation</h2>
<ul class="incremental">
<li><code>rpm -ivh --test new-kernel.rpm</code></li>
<li>with <code>--test</code> option</li>
<li>It's useful when doing critical updates or instalations and when you want to see if there will be any problem during the RPM process</li>
</ul>
<h2 id="macro">Macro</h2>
<ul class="incremental">
<li><code>rpm --showrc</code> print rpm configuration and macro</li>
<li>Can be used in <em>queryformat</em></li>
</ul>
<h1 id="advanced">Advanced</h1>
<h2 id="repair-rpm-database">Repair RPM database</h2>
<p>See <a href="http://fedoranews.org/alex/tutorial/rpm/16.shtml">How can I get RPM back? The command &quot;rpm -qa&quot; returns nothing!</a></p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">rm</span> -f /var/lib/rpm/__* <span class="kw">;</span> <span class="ex">rpm</span> -vv --rebuilddb</code></pre></div>
<h2 id="figure-out-the-installation-time-of-my-package">Figure out the installation time of my package</h2>
<p>See <em>How can I figure out the installation time of my packages?</em></p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">rpm</span> -qa --queryformat <span class="st">&#39;%{installtime} %{installtime:date} %{name}-%{version}\n&#39;</span> <span class="kw">|</span> <span class="fu">sort</span> -n <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/^[0-9]*//&#39;</span></code></pre></div>
<p>or</p>
<pre><code>rpm -qa -last | tac
</code></pre>
<h2 id="figure-out-the-size-of-a-installed-package">Figure out the size of a installed package</h2>
<p>See <a href="http://fedoranews.org/alex/tutorial/rpm/18.shtml">How can I figure out the size of a installed package?</a></p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">rpm</span> -qa --queryformat <span class="st">&#39;%10{size} %{name}-%{version}\n&#39;</span> <span class="kw">|</span> <span class="fu">sort</span> -n</code></pre></div>
<h1 id="best-practice">Best Practice</h1>
<h2 id="update-kernel">Update Kernel</h2>
<ul class="incremental">
<li><strong>Always</strong> keep the current Kernel installed when upgrade</li>
<li>You can fallback when something trouble happens</li>
<li><strong>Never</strong> use the &quot;Freshen&quot; or &quot;Upgrade&quot; commands unless you really knows what will going to happen</li>
<li>try to use the Test option before executing the final command</li>
<li><strong>Always</strong> try to install, not upgrade.</li>
</ul>
<h2 id="rpmbuild"><code>rpmbuild</code></h2>
<ul class="incremental">
<li>Rebuild the source (installed <code>src.rpm</code> package) with <code>rpmbuild</code></li>
<li>Guided with specification in <code>/usr/src/redhat/SPECS</code></li>
<li>and generate new rpm in <code>/usr/src/redhat/RPMS/&lt;arch&gt;</code></li>
<li>Something like Archlinux's abs system and <code>PKGBUILD</code> specification?</li>
</ul>
<h1 id="note">Note</h1>
<h2 id="repackage">repackage</h2>
<ul class="incremental">
<li>The <code>repackage</code> option (for example, <code>rpm -Uvh --repackage &lt;old-package&gt;</code>) seems been depreciated</li>
<li>It was used for re-package the old version package when upgrading or removing and store the rpm in <code>_repackage_dir</code> for fallback rescure</li>
</ul>
<h2 id="signature-verify">Signature verify</h2>
<ul class="incremental">
<li>It seems the command refers by <a href="http://fedoranews.org/alex/tutorial/rpm/14.shtml">rpm tutorial</a> had been removed from current RPM toolkit?</li>
<li>Basic steps
<ol class="incremental">
<li><p>import the public key</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">rpm</span> --import /usr/share/rhn/GPG-KEY</code></pre></div></li>
<li><p>check the keys?</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">rpm</span> -qi gpg-pubkey <span class="kw">|</span> <span class="fu">more</span></code></pre></div></li>
<li><p>verify a package</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">rpm</span> -K package.rpm</code></pre></div></li>
</ol></li>
</ul>
<h1 id="problem">Problem</h1>
<h2 id="rpmlib"><code>rpmlib</code></h2>
<h2 id="yum-vs-rpm"><code>yum</code> vs <code>rpm</code></h2>

			</div>
		</section>
	</body>
</html>
